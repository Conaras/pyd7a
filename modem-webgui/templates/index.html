<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>D7 modem-webgui</title>
    <link rel="stylesheet" href="http://cdn.webix.com/edge/webix.css" type="text/css">
    <script src="http://cdn.webix.com/edge/webix.js" type="text/javascript"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        var socket;
        var received_alp_commands = [];

        $(document).ready(function() {
            namespace = '';
            socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

            socket.on('connect', function() {
                console.log('connected');
            });

            socket.on('module_info', function(data) {
                console.log('connected to module: ' + data.uid);
                $$('header').setValues({header:"oss7", status:
                        'Connected to ' + data.uid + ' using D7AP v' + data.d7ap_version + ' running app \'' + data.application_name +
                        '\' using git sha1' + data.git_sha1}
                )
            });

            socket.on('received_alp_command', function(msg) {
                received_alp_commands.push(msg);
                $$("received_alp_commands_list").clearAll();
                $$("received_alp_commands_list").parse(received_alp_commands);
            });
        });
    </script>
</head>
<body>
<script type="text/javascript" charset="utf-8">
    webix.ui({
        rows:[
            { view:"template", type:"header", template:"#header# - #status#", id:"header", data:{
                header:"oss7 modem interface", status:"not connected"
            }},
            { view:"tabview", cells: [
                {
                    header: "Read local file",
                    body: {
                        view:"form", id:"read_local_file_form", elements:[
                            { view:"text", label:'file ID', validate:webix.rules.isNumber, name:"file_id" },
                            { view:"text", label:'offset', validate:webix.rules.isNumber, name:"offset", value: 0 },
                            { view:"text", label:'length', validate:webix.rules.isNumber, name:"length", value: 0 },
                            { view:"button", type:"form", value:"Read file",
                                click:function () {
                                    var form = $$("read_local_file_form")
                                    if(form.validate()) {
                                        // TODO post?
                                        socket.emit('read_local_file', form.getValues())
                                    }
                                }
                            }
                        ]
                    }
                },
                {
                    header: "Read system file",
                    body: {
                        view:"form", id:"read_local_system_file_form", elements:[
                            {view:"select", label:"System file", value: 0, name:"system_file_id", options:[
                                {% for id, file in systemfiles.iteritems() %}
                                    {id: "{{ id}}", value:  "{{ file.__class__.__name__ }}"},
                                {% endfor %}
                            ]},
                            { view:"button", type:"form", value:"Read file",
                                click:function () {
                                    var form = $$("read_local_system_file_form")
                                    if(form.validate()) {
                                        // TODO post?
                                        console.log(form.getValues())
                                        socket.emit('read_local_system_file', form.getValues())
                                    }
                                }
                            }
                        ]
                    }
                },
                {
                    header: "Execute raw ALP command",
                    body: {
                        view:"form", id:"execute_raw_alp_form", elements:[
                            { view:"text", "label":"Raw ALP command", "placeholder":"Raw ALP command", name:"raw_alp"},
                            { view:"button", type:"form", value:"Execute",
                                click:function () {
                                    var form = $$("execute_raw_alp_form")
                                    if(form.validate()) {
                                        // TODO post?
                                        console.log(form.getValues())
                                        socket.emit('execute_raw_alp', form.getValues());
                                    }
                                }
                            }
                        ]
                    }
                }
            ]},
            {
                view:"accordion",
                rows:[
                    {
                        header: "Received ALP commands",
                        body: {
                            view:"list",
                            id:"received_alp_commands_list",
                            template: "#ts# - #cmd#",
                            data:received_alp_commands
                        }
                    }
                ]
            }
        ]
    });
</script>
</body>
</html>